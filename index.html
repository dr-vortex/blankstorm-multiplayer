<!DOCTYPE html>
<html>
	<head>
		<title>Annihilation Socket Test</title>
		<link rel=stylesheet href=https://a.drvortex.dev/libraries/styles.css>
	</head>
	<body>
		<button id=connect>Connect</button>
		<button id=ping>Ping</button>
		<br>
		<input id=type placeholder='Packet Type' style=height:1.5em>
		<input id=data placeholder='Data' style=min-width:350px;height:1.5em>
		<button id=packet>Send Packet</button>
		<br>
		<ul id=log style=font-family:monospace;max-width:50% lsn nobg></ul>
		<script src=/libraries/jquery.js></script>
		<script src=/libraries/socket.max.js></script>
		
		<script>
			Object.prototype.toString = Array.prototype.toString = function(){return JSON.stringify(this)}
			const log = data => $('<li></li>').html(data).appendTo('#log');
			let socket;
			$('#connect').click(e => {
				log('Attempting to connect')
				socket = io('mp.annihilation.drvortex.dev', { reconnection: false });
				socket.on('connect' , s => {
					log('Connected to server as ' + socket.id);
				});
				socket.on('connect_error', err => {
					log('Connection error: ' + err);
				});
				socket.on('connect_failed', err => {
					log('Connection failed: ' + err);
				});
				socket.on('packet', packet => {
				    log('[Server] ' + (packet instanceof Array ? `Array (${packet.length})<br>` + packet.join('<br>') : packet));
				});
				socket.on('chat', message => {
				   log(`[Chat] ${message.user}: ${message.content}`);
				});
			});
			$('#ping').click(e => {
				if(socket.connected){
					socket.emit('ping');
				}else{
					log('Can\'t send ping: socket not connected');
				}
			});
			$('#packet').click(e => {
				socket.connected ? socket.emit('packet',$('#type').val(),$('#data').val())
				: log(`Can't send ${$('#type').val()} packet: socket not connected`);
				$('#data').val('')
			});
			$('#data,#type').keypress(e => {
			    if(e.key == 'Enter'){
			        $('#packet').click();
			    }
			});
		</script>
	</body>
</html>